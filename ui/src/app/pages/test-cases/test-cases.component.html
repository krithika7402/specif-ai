<div
  class="bg-white border rounded-lg p-5 flex flex-col h-full lg:col-span-2 w-full"
  *ngIf="testCases$ | async as testCases"
>
  <div class="mb-4">
    <div class="flex items-center mt-2 justify-between">
      <div class="flex flex-col gap-2 min-w-0">
        <h1
          class="text-lg font-bold text-secondary-800 truncate max-w-full pr-8"
        >
          Test Cases for {{ navigation.selectedRequirement?.id }}:
          {{ navigation.selectedRequirement?.name }}
        </h1>

        <div class="flex items-center">
          <h2 class="text-md font-semibold text-secondary-600">Test Cases</h2>
          <app-badge [badgeText]="testCases.length"></app-badge>
        </div>
      </div>

      <div class="flex items-center justify-between gap-3">
        <div class="flex gap-2">
          <app-button
            [buttonContent]="
              testCases.length === 0
                ? 'Generate Test Cases'
                : 'Regenerate Test Cases'
            "
            theme="secondary"
            size="sm"
            (click)="addMoreContext(testCases.length > 0)"
            rounded="lg"
            matTooltip="Add screens and context information for test case generation"
          />
          <app-button
            buttonContent="Add Test Case"
            theme="primary"
            size="sm"
            (click)="navigateToAddTestCase()"
            rounded="lg"
            matTooltip="Add a new test case manually"
          />
        </div>
        <app-export-dropdown
          [disabled]="testCases.length === 0"
          [options]="exportOptions"
        />
      </div>
    </div>

    <!-- Search and filters -->
    <div *ngIf="testCases.length > 0" class="mb-4">
      <app-search-input
        placeholder="Search..."
        (searchChange)="onSearch($event)"
        class="mb-4"
      ></app-search-input>
      
      <div class="grid grid-cols-3 gap-4">
        <!-- Priority filter -->
        <app-select
          [options]="priorityOptions"
          [placeholder]="'Filter by priority'"
          (selectionChange)="onPriorityFilterChange($event)"
          [clearable]="true"
        ></app-select>
        
        <!-- Type filter -->
        <app-select
          [options]="typeOptions"
          [placeholder]="'Filter by type'"
          (selectionChange)="onTypeFilterChange($event)"
          [clearable]="true"
        ></app-select>
        
        <!-- Steps count filter -->
        <app-select
          [options]="stepsCountOptions"
          [placeholder]="'Filter by steps count'"
          (selectionChange)="onStepsCountFilterChange($event)"
          [clearable]="true"
        ></app-select>
      </div>
    </div>
  </div>

  <div class="h-full overflow-y-auto">
    <!-- User Story specific view -->
    <ng-container *ngIf="((filteredTestCases$ | async)?.length ?? 0) > 0; else noTestCases">
      <app-unified-card
        *ngFor="let testCase of filteredTestCases$ | async"
        [id]="testCase.id"
        [title]="testCase.title"
        [description]="testCase.description"
        [borderClass]="getTestCaseBorderClass(testCase)"
        [statusIndicator]="getTestCaseStatusIndicator(testCase)"
        [badges]="getTestCaseBadges(testCase)"
        [actionButtonText]="'View Details'"
        [copyTooltip]="'Copy test case content'"
        (viewItem)="navigateToEditTestCase(testCase)"
        (copyContent)="copyTestCaseContent($event, testCase)"
      ></app-unified-card>
    </ng-container>

    <!-- Empty State Message -->
    <ng-template #noTestCases>
      <h1 class="text-secondary-700 my-4 text-center">
        No Test Cases Found. Generate test cases by clicking the
        <strong>"Generate Test Cases"</strong> button.
      </h1>
    </ng-template>
  </div>
</div>

<app-workflow-progress-dialog
  [isVisible]="showThinkingProcess"
  [projectId]="userStoryId"
  [workflowType]="WorkflowType.TestCase"
  [isCompleted]="testCases.length > 0"
  [initialTitle]="thinkingProcessConfig.title"
  [completedTitle]="'Test Cases Generated Successfully!'"
  [subtitle]="thinkingProcessConfig.subtitle"
  [completionButtonText]="'Continue'"
  [showCancelButton]="false"
  (closeDialog)="showThinkingProcess = false"
></app-workflow-progress-dialog>
