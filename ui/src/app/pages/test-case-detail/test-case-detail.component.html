<div class="bg-white border rounded-lg p-5 flex flex-col h-full w-full">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-semibold">
      {{ mode === 'add' ? 'Add New Test Case' : (testCaseForm.get('id')?.value || 'Test Case') }}
    </h1>
    
    <!-- Action buttons based on mode -->
    <div class="flex gap-3">
      <!-- View mode buttons -->
      <ng-container *ngIf="mode === 'view'">
        <app-button
          buttonContent="Edit"
          theme="primary"
          size="sm"
          rounded="lg"
          (click)="enableEditMode()"
        />
        <app-button
          buttonContent="Back"
          theme="secondary"
          size="sm"
          rounded="lg"
          (click)="cancel()"
        />
      </ng-container>
      
      <!-- Edit/Add mode buttons -->
      <ng-container *ngIf="mode === 'edit' || mode === 'add'">
        <app-button
          [buttonContent]="mode === 'add' ? 'Create' : 'Save'"
          theme="primary"
          size="sm"
          rounded="lg"
          (click)="saveTestCase()"
        />
        <app-button
          buttonContent="Cancel"
          theme="secondary"
          size="sm"
          rounded="lg"
          (click)="cancel()"
        />
      </ng-container>
    </div>
  </div>
  
  <!-- Test Case Form -->
  <div class="rounded-md" [formGroup]="testCaseForm">
    <!-- Title -->
    <div class="mb-4">
      <label class="block text-secondary-700 text-sm font-medium mb-2">
        Title <span class="text-danger-500 text-xs">*</span>
      </label>
      <app-input-field
        elementId="title"
        formControlName="title"
        [elementPlaceHolder]="'Enter test case title'"
        [hasError]="hasError('title')"
        errorMessage="Title is required"
      />
    </div>
    
    <!-- Description -->
    <div class="mb-4">
      <label class="block text-secondary-700 text-sm font-medium mb-2">
        Description <span class="text-danger-500 text-xs">*</span>
      </label>
      <app-textarea-field
        elementId="description"
        formControlName="description"
        [elementPlaceHolder]="'Enter test case description'"
        [rows]="3"
        [hasError]="hasError('description')"
        errorMessage="Description is required"
      />
    </div>
    
    <!-- Priority, Type, Status in a row -->
    <div class="grid grid-cols-3 gap-4 mb-4">
      <!-- Priority -->
      <div>
        <label class="block text-secondary-700 text-sm font-medium mb-2">
          Priority <span class="text-danger-500 text-xs">*</span>
        </label>
        <app-select
          [options]="priorityOptions"
          placeholder="Select priority"
          formControlName="priority"
          [required]="true"
        ></app-select>
      </div>
      
      <!-- Type -->
      <div>
        <label class="block text-secondary-700 text-sm font-medium mb-2">
          Type <span class="text-danger-500 text-xs">*</span>
        </label>
        <app-select
          [options]="typeOptions"
          placeholder="Select type"
          formControlName="type"
          [required]="true"
        ></app-select>
      </div>
      
      <!-- Status -->
      <div>
        <label class="block text-secondary-700 text-sm font-medium mb-2">
          Status <span class="text-danger-500 text-xs">*</span>
        </label>
        <app-select
          [options]="statusOptions"
          placeholder="Select status"
          formControlName="status"
          [required]="true"
        ></app-select>
      </div>
    </div>
    
    <!-- Pre-conditions -->
    <div class="mb-4">
      <div class="flex justify-between items-center mb-2">
        <label class="block text-secondary-700 text-sm font-medium">
          Pre-conditions
        </label>
        <app-button
          *ngIf="mode !== 'view'"
          [isIconButton]="true"
          icon="heroPlus"
          theme="secondary_outline"
          size="xs"
          rounded="lg"
          (click)="addPreCondition()"
          matTooltip="Add pre-condition"
        />
      </div>
      
      <div formArrayName="preConditions" class="space-y-2">
        <div *ngFor="let condition of preConditions.controls; let i = index" class="flex items-center gap-2">
          <app-input-field
            [elementPlaceHolder]="'Enter pre-condition'"
            [formControlName]="i"
            class="flex-grow"
          />
          <app-button
            *ngIf="mode !== 'view'"
            [isIconButton]="true"
            icon="heroTrash"
            theme="danger"
            size="xs"
            rounded="lg"
            (click)="removePreCondition(i)"
            matTooltip="Remove pre-condition"
          />
        </div>
        
        <div *ngIf="preConditions.length === 0" class="text-secondary-500 text-sm italic">
          No pre-conditions defined
        </div>
      </div>
    </div>
    
    <!-- Test Steps -->
    <div>
      <div class="flex justify-between items-center mb-2">
        <label class="block text-secondary-700 text-sm font-medium">
          Test Steps <span class="text-danger-500 text-xs">*</span>
        </label>
        <app-button
          *ngIf="mode !== 'view'"
          [isIconButton]="true"
          icon="heroPlus"
          theme="secondary_outline"
          size="xs"
          rounded="lg"
          (click)="addStep()"
          matTooltip="Add step"
        />
      </div>
      
      <div formArrayName="steps" class="space-y-4">
        <div *ngFor="let step of steps.controls; let i = index" [formGroupName]="i" 
             class="border border-secondary-200 rounded-lg p-3">
          <div class="flex justify-between items-center mb-2">
            <h3 class="text-secondary-700 font-medium">Step {{ i + 1 }}</h3>
            <app-button
              *ngIf="mode !== 'view'"
              [isIconButton]="true"
              icon="heroTrash"
              theme="danger"
              size="xs"
              rounded="lg"
              (click)="removeStep(i)"
              matTooltip="Remove step"
            />
          </div>
          
          <!-- Action -->
          <div class="mb-2">
            <label class="block text-secondary-700 text-sm font-medium mb-1">
              Action <span class="text-danger-500 text-xs">*</span>
            </label>
            <app-textarea-field
              formControlName="action"
              [elementPlaceHolder]="'Describe the action to perform'"
              [rows]="2"
              [hasError]="hasStepError(i, 'action')"
              errorMessage="Action is required"
            />
          </div>
          
          <!-- Expected Result -->
          <div>
            <label class="block text-secondary-700 text-sm font-medium mb-1">
              Expected Result <span class="text-danger-500 text-xs">*</span>
            </label>
            <app-textarea-field
              formControlName="expectedResult"
              [elementPlaceHolder]="'Describe the expected result'"
              [rows]="2"
              [hasError]="hasStepError(i, 'expectedResult')"
              errorMessage="Expected result is required"
            />
          </div>
        </div>
        
        <div *ngIf="steps.length === 0" class="text-danger-500 text-sm italic">
          At least one test step is required
        </div>
      </div>
    </div>
  </div>
</div>
